const timelineData = [
	{
		date: 'May 18, 2025',
		title: 'First Picture',
		desc: "Ito talaga yung picture na hindi ko makakalimutan.",
		color: '#667eea',
		icon: '👀',
		photo: '1st/main/photos/firstPic.jpeg',
		letter: {
			title: 'The Beginning HAHAHA',
			content: `Hello baby,<br><br>
			This picture was the beginning,
			imagine, dito nagsimula ang lahat HAHAHAHA.
			From the very first time I saw you, I already knew you were special,
			so precious to me, and that’s why I’ve always treated you like my princess.<br><br>
			oa na kung oa pero totoo yon HAHAHA.
			'di ako mag eeffort maggawa ng napaka tagal at napaka hirap na handmade na flower kung eme eme lang yan aa naman`,
			signature: 'Lloydiee :33💕'
		}
	},

	{
		date: 'June 19, 2025',
		title: 'First Meet',
		desc: 'First meet na parang HAHAHAHA',
		color: '#764ba2',
		icon: '🌸',
		photo: '1st/main/photos/firstPhotobooth.jpg',
		letter: {
			title: 'First Ever Meet',
			content: `First meet, lasts!<br><br>
			This was our very first photobooth together, 
			look how close we were kahit first time pa lang.
			I want our first meet to be memorable, alam mo naman yan kasi lagi ko nababanggit, and
			I hope naging memorable din sayo ang first meet natin. <br><br>
			And also, I believe that a good first meet really lasts.
			What I mean is, if the first meet is boring or awkward, paano pa masusundan, right?
			Kaya ayun, I’m so happy, and I hope you are too hehe.`,
			signature: 'Lloydiee :33💕'
		}
	},

	{
		date: 'July 14, 2025',
		title: 'Second Meet',
		desc: 'Second meet na nakita pa sila Frian :))',
		color: '#f093fb',
		icon: '🤭',
		photo: '1st/main/photos/2ndbooth.JPG',
		letter: {
			title: 'Second Meet',
			content: `The Angle I Want,<br><br>
			This was the time you came to Lipa and all I can say is I felt so special, 
			especially when you mentioned that you never really visited your past dates. 
			Then one time, nag-usap tayo and I found out na kaya ka pala nagpunta sa SM Lipa 
			was not really for me, kundi gusto mo lang pala gumala HAHHAHAHA.<br><br>
			But anyways, masaya pa rin ako kahit ganon yung na fefeel mo,
			nakapag pictrue tayo ng angle na gusto ko hehe. 
			Na-meet pa natin si Frian at ang bebe niya nang biglaan, nagkaroon pa ng biglaang business partner e.`,
			signature: 'Lloydiee :33💕'
		}
	},
	
	
	{
		date: 'July 14, 2025',
		title: 'Yogurt Date!',
		desc: 'Still in SM with you',
		color: '#4facfe',
		icon: '🍨',
		photo: '1st/main/photos/yogurtSM.jpg',
		letter: {
			title: 'Yogurt with You',
			content: `Last meet na ba?<br><br>
			I really thought this is last time for us. After we stopped talking, 
			I just kept looking at this photo, 'cause look at how happy we were in this moment, 
			it felt so genuine to me. <br><br>
			This was also the time when we talked about life and how we adjust whenever we're together, 
			since we have different attitudes and perspectives in life, kaya it feels so different.`,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'August 7, 2025',
		title: 'BFC Comeback?',
		desc: "Guess what, we're back HAHAHA",
		color: '#43e97b',
		icon: '💕',
		photo: '1st/main/photos/ukay.jpeg',
		letter: {
			title: "Who would've thought?",
			content: `Mala Daniel Caesar e,<br><br>	
			Who would've thought nga naman na masusundan pa pala yung second meet natin?
			'Di ko talaga in-expect na mangyayari yun, given everything you told me. 
			It was August 4, 2025, 12:38AM, biglang tumibok ng mabilis yung puso ko dahil sa kaba HAHAHAHA.
			bigla-bigla ka na lang nag-chat e.<br><br>
			Anyways, eto yung time na parang bumalik lahat ng saya sa akin, na para bang HAHAHAHA.
			na fefeel ko na baka mag wowork this time kasi iba talaga yung pakiramdam e,
			na parang we’re both doing better this time.<br><br>
			Thank you for taking the risk with me, Joey.`,
			signature: 'Lloydiee :33💕'
		}
	},
	
	{
		date: 'August 13, 2025',
		title: 'Your Birthday!',
		desc: 'Her birthday with her friends.',
		color: '#fa709a',
		icon: '🎂',
		photo: '1st/main/photos/herBirthday.jpeg',
		letter: {
			title: `It's your day!`,
			content: `So gorgeous!<br><br>
			It’s your birthday, sadly wala ako to celebrate with you kasi may class ako, 
			but still, you had your friends to celebrate with. May nag-surprise pa nga sayo 
			at nag-effort talaga silang lahat. 
			Swerte mo sa friends, love them the way you love yourself, and of course, love me differently 😝 <br><br>
			I know you won’t believe me when I say you’re so pretty, gorgeous, beautiful, etc., 
			kasi ayaw mo ng ganong compliments, pero kasi it’s the truth e. 
			Look at the picture on the left side, tamo, apaka GORGEOUS!! 
			Swerte ko naman na ganyan ka-ganda ang Girlfriend ko.<br><br>
			Sasabihan mo na naman ako ng “iww”, “oa” HAHAHAHAHHA, basang-basa ko na galawan mo e.`,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'August 16, 2025',
		title: 'Still her Birthday?!',
		desc: 'Simple celebration with just us two.',
		color: '#ff6b6b',
		icon: '☕',
		photo: '1st/main/photos/askher.jpeg',
		letter: {
			title: 'Still your Birthday',
			content: `The Beginning ba ulit? HAHAHA<br><br>
			This was the time we went out for a date to have a late celebration for your birthday.  
			Every time we go out, it always feels so special walang dull moments with you e. 
			Parang ayoko na umuwi sa amin kapag ikaw yung pinupuntahan ko or kapag kasama kita, huhu.<br><br>
			This was also the day I asked you something with the letter I gave you, 
			and you said “bad move.” Late ko na lang na-realize, “shet oo nga 'no” HAHAHAHA.<br><br>
			Eto rin yung time na inuwi mo ako sa inyo. Dapat mabilis lang kasi pahapon na, 
			pero umabot na ng gabi hanggang sa hindi na ako pinauwi at nakitulog na lang ako sa inyo aa huhu.  
			But anyways, I’M SUPER HAPPY kasi you brought me home like sobrang assurance na yon for me.`,
			signature: 'Lloydiee :33💕'
		}
	},
		{
		date: 'August 16, 2025',
		title: 'Home Run?',
		desc: 'Her home with me mwhehe',
		color: '#4ecdc4',
		icon: '🏠',
		photo: '1st/main/photos/herHome.mp4',
		letter: {
			title: 'Touchdown guys',
			content: `Hello Joey,<br><br>
			I just wanna say that I'm so happy kasi inuwi mo ako sa inyo.
			I really can't believe na ipinakilala mo ako sa parents mo and sa mga kapatid mo agad-agad.
			Grabe yung kaba ko kahit hindi pasmado, nababasa kamay ko e HAHAHHAHA.
			<br><br>
			Thank you for bringing me home. Just like what I've said, isang malaking assurance 'yon for me.
			'Di mo naman siguro ako iuuwi kung hindi ka sure sakin e, tama ba? HAHAHA.
			<br><br>
			Tamo naman kung gaano ka ka-clingy nung nasa inyo na tayo. Sadya namang dikit kung dikit e. Tamo, may pag halik pa.`,
			signature: 'Lloydiee :33💕'
		}
	},

		{
			date: 'August 16, 2025',
			title: 'With Suzy!',
			desc: 'Picture with Suzy cutieee',
			color: '#45b7d1',
			icon: '🐾',
			photo: '1st/main/photos/withSuzy.jpeg',
			letter: {
				title: 'With pretty Suzy ',
				content: `Pic with Suzy,<br><br>
				Look how cute this picture is. 
				Sinama ko talaga 'to sa timeline natin kasi wala lang, 
				ang cute lang talaga kasi e.
				<br><br>
				Ang iyong anak na minsan ay amoy tubal, pero at least malambing diba.
				Isang tunog lang sa plato, lalapit agad e.
				Sarap iuwi. Peram ako mga 1 week balik ko din agad HAHHAHHA.
				<br><br>`,
				signature: 'Lloydiee :33💕'
			}
		},

	{
		date: 'August 23, 2025',
		title: 'Flowers',
		desc: 'Cute flowers for her!',
		color: '#96ceb4',
		icon: '🌺',
		photo: '1st/main/photos/flowers.jpg',
		letter: {
			title: 'Simple Flowers',
			content: `Wrong move?,<br><br>
			This is the time na nag punta ako sa inyo para sunduin ka at ipakilala sa family ko.
			Ang sarap sa feeling na nag paalam ako sa parents mo na iuuwi kita at ibabalik din kita after kumain and all.
			Then sabi ni tita wag na daw kita ibalik, saka na po tita mag mag lilive in na kami😱
			ay HAHAHAAHAHAHA.
			<br><br>
			I bought you flowers kasi you deserve it and also para maging official suitor mo ako HHAAHHHAHA.
			ang cute nga e color green, pink and white, 
			first time ko lang din maka kita ng green na flowers kasi puro pink and white lang din e.
			<br><br>
			Thank you kasi pumayag ka na iuwi kita sa amin at makilala ng family ko, 
			ang sarap sa feeling na sumama ka sakin na para bang wala kang choice HAHAHAHA. 
			kidding asside, so so happy na makikilala ka ng family ko. 
			First time ko magpapakilala sa kanila kaya papunta at pabalik sa amin sobrang kinakabahan ako.`,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'August 23, 2025',
		title: 'Home Run Again??',
		desc: 'OTW sa amin HAAHHHA',
		color: '#feca57',
		icon: '🚗',
		photo: '1st/main/photos/carFave.jpg',
		letter: {
			title: 'On the Way HAHA',
			content: `One of my fave pic,<br><br>
			Ayan na ang moment na inintay ng lahat, on the way papunta sa amin.
			To be honest, sobrang kinakabahan ako nung araw na yon.
			Sino ba naman hindi sa first time??
			Ang cute mo kasi randam ko din yung kaba tas hindi mapakali, 
			"bagalan mo lang" HAHAHAHHAAH
			<br><br>
			Inuwi kita kasi gusto ko talaga makilala mo family ko at gusto ko din malaman nila na may maganda akong iniirog HAHAHAH.
			Gusto ko isama yung vid na inedit mo kaso medyo malaki yung file so hindi kaya.
			<br><br>
			Anyways, Thank you so much sa pag sama sa akin pauwi! 
			sobra sobrang saya ko lang kasi ibang level na tayo to the point na nag uuwian na sa bahay bahay HAHAHHHA`,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'August 23, 2025',
		title: 'Touch down HAHA',
		desc: 'Shy type e nung nasa amin na HAHAHA',
		color: '#ff9ff3',
		icon: '🏡',
		photo: '1st/main/photos/samin.mp4',
		letter: {
			title: 'Change personality?',
			content: `Bat parang nag iba bigla HAHA,<br><br>
			Look how shy you are aa, ibang iba nung nasa car pa lang tayo e, may pag yapos pa pero nung nasa amin na hahawakan ko lang kamay abay naglalalayo "lumayo ka sakin" HAHAHHAHA.
			<br><br>
			Finally, nasa amin ka na!! na meet mo na family ko and i can say na sobra sila nag ccare sayo.
			Nakaka panibalo lang tingnan kasi para sadyang nag bago ang anyo mo eh, bigla-bigla nagiging mahiyain HAHAHAHA.
			<br><br>
			So so cute my loveee!`,
			signature: 'Lloydiee :33💕'
		}
	},
		{
			date: 'August 23, 2025',
			title: 'Family Lunch',
			desc: 'Meet my family and eat lunch with them',
			color: '#ff6b6b',
			icon: '💕',
			photo: '1st/main/photos/fam2.jpg',
			letter: {
				title: "Luna's birthday!",
				content: `Fam lunch,<br><br>
				At this moment, napakilala na kita sa fam ko. 
				Ang cute lang ng mga kapatid ko kasi binibiro nila ako HAHAHAHHA.
				Tapos one thing na napansin ko is nag-s-smile si papa kasi lahat kami ay may sari-sariling dala ng bebe, tapos nag-picture pa siya ng pasimple.
				<br><br>
				No words can explain my feelings in that moment because my family was showing care for you. 
				Imagine, after the accident nag-offer pa sila Ninong Ry na sila na daw maghahatid sayo. That's so much love!!
				Before and after ihatid, tinatanong ka pa ni papa like kinakamusta ka kung ano nangyari, naihatid ba, kung okay ka lang ba, etc.
				Swear, if merong pinaka masaya sa mundo, ako 'yon.
				Sobrang bait nila sayo!
				<br><br>
				Thank you din for giving Luna a gift, sobrang saya niya. Dinala pa nga niya sa US yung gift mo sa kanya. And
				I hope naging memorable din sayo ang welcome sayo ng fam ko!`,
				signature: 'Lloydiee :33💕'
			}
		},

			{
			date: 'August 23, 2025',
			title: 'Photobooth w/ thrill?',
			desc: 'Photo booth for the month of August',
			color: '#a8e6cf',
			icon: '🫣',
			photo: '1st/main/photos/photoSM.mp4',
			letter: {
				title: 'Level up??',
				content: `3rd official photobooth,<br><br>
				After we ate lunch with my family, we went to SM with my brothers and their partners too. 
				Then we simply separated from them to take a photobooth.
				Look oh, lumelevel up na may pa-kiss na e.
				Ang saya lang tingnan kasi when you look closely, hindi siya malaswa tingnan. Ang cute lang talaga.
				<br><br>
				Not assuming, pero feel ko talaga we're taking it seriously na. What I mean is, kahit na I'm courting you pa lang, parang I have assurance na magiging tayo in the future. wala lang bat ba HAHAHA
				<br><br>`,
				signature: 'Lloydiee :33💕'
			}
		},

		{
			date: 'August 23, 2025',
			title: 'Four couples!',
			desc: 'Picture with four couples',
			color: '#ffd93d',
			icon: '🫘',
			photo: '1st/main/photos/withBrother.jpeg',
			letter: {
				title: '4 Couples',
				content: `Cute ni Lyannah HAHA,<br><br>
				Quality time with my brothers, look oh, ang gaganda nyo lahat.
				Para bang nagpapagandahan kami ng bebe e HAHHAHA.<br><br>
				Ang ganda ng usapan here e, tinatanong tayo kung paano tayo nagsimula, saan nagkakilala and all.
				<br><br>
				Etong araw na 'to ay sobrang memorable at sobrang nakaka-overwhelmed. 
				Imagine sobrang daming nangyari, sobrang saya, stress, kaba, lahat na lang ng pwedeng maramdaman ay naramdaman na HAHAHHAHAH.
				<br><br>
				So grateful to have you in my life, Joey!`,
				signature: 'Lloydiee :33💕'
			}
		},

	{
		date: 'August 30, 2025',
		title: 'Samgy date<33',
		desc: 'Samgy date na para bang hindi diet HAHAHAHA',
		color: '#81c784',
		icon: '🥓🥬🍚',
		photo: '1st/main/photos/samgy.mp4',
		letter: {
			title: '',
			content: ``,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'September 6, 2025',
		title: "She's mine!",
		desc: 'The day i will never forget!',
		color: '#64b5f6',
		icon: '💞',
		photo: '1st/main/photos/saidYes.mp4',
		letter: {
			title: '',
			content: ``,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'September 6, 2025',
		title: 'Date with her',
		desc: 'All the dreams we have for our future together.',
		color: '#ba68c8',
		icon: '🥰',
		photo: '1st/main/photos/yesyes.jpg',
		letter: {
			title: '',
			content: ``,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'September 13, 2025',
		title: 'Far from home?!',
		desc: 'PG to LB HAHHAHAHA',
		color: '#ffb347',
		icon: '🍓',
		photo: '1st/main/photos/swing.jpg',
		letter: {
			title: '',
			content: ``,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'September 13, 2025',
		title: 'Fave live photo',
		desc: 'Tampo pa yan sha HAHAHHA',
		color: '#6dd5ed',
		icon: '💗ྀི',
		photo: '1st/main/photos/tampo.mp4',
		letter: {
			title: 'Tampo tampuhan e HAHAHHA',
			content: ``,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'September 13, 2025',
		title: 'Candid picture',
		desc: 'A candid picture with her',
		color: '#b388ff',
		icon: '📸',
		photo: '1st/main/photos/back.png',
		letter: {
			title: '',
			content: ``,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'September 20, 2025',
		title: 'S&R Salad!',
		desc: 'Before the sakuna(massage na napakasakit)',
		color: '#ff6e7f',
		icon: '🥗',
		photo: '1st/main/photos/pizzaSalad.jpg',
		letter: {
			title: '',
			content: ``,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'September 20, 2025',
		title: 'Another coffee date',
		desc: 'A quality time with her',
		color: '#43cea2',
		icon: '☕',
		photo: '1st/main/photos/walter.jpg',
		letter: {
			title: '',
			content: ``,
			signature: 'Lloydiee :33💕'
		}
	}
];
let particles = [];
let isMouseMoving = false;
let mousePosition = { x: 0, y: 0 };
let animationFrameId = null;

class Particle {
	constructor(x, y, color = '#ffffff') {
		this.x = x;
		this.y = y;
		this.vx = (Math.random() - 0.5) * 2;
		this.vy = (Math.random() - 0.5) * 2;
		this.life = 1;
		this.decay = Math.random() * 0.02 + 0.005;
		this.size = Math.random() * 3 + 1;
		this.color = color;
		this.opacity = Math.random() * 0.8 + 0.2;
	}

	update() {
		this.x += this.vx;
		this.y += this.vy;
		this.life -= this.decay;
		this.opacity = this.life * 0.8;
		this.vx *= 0.98;
		this.vy *= 0.98;
	}

	draw(ctx) {
		ctx.save();
		ctx.globalAlpha = this.opacity;
		ctx.fillStyle = this.color;
		ctx.beginPath();
		ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
		ctx.fill();
		ctx.restore();
	}

	isDead() {
		return this.life <= 0;
	}
}

function createFloatingParticles() {
	const particlesContainer = document.getElementById('particles');
	if (!particlesContainer) return;

	for (let i = 0; i < 50; i++) {
		const particle = document.createElement('div');
		particle.className = 'particle';
		particle.style.left = Math.random() * 100 + '%';
		particle.style.animationDelay = Math.random() * 8 + 's';
		particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
		particlesContainer.appendChild(particle);
	}
}

function render3DTimeline() {
	const orbsContainer = document.getElementById('timeline-orbs');
	if (!orbsContainer) return;

	orbsContainer.innerHTML = '';

	orbsContainer.innerHTML = '';
	const baseOrbSize = 80;
	timelineData.forEach((data, i) => {
		const orb = document.createElement('div');
		orb.className = 'orb';
		orb.style.marginTop = (i % 2 === 0) ? '0px' : '40px';
		orb.style.marginBottom = (i % 2 === 0) ? '40px' : '0px';
		orb.style.width = baseOrbSize + 'px';
		orb.style.height = baseOrbSize + 'px';
		orb.style.background = `linear-gradient(135deg, ${data.color} 0%, #764ba2 100%)`;
		orb.innerHTML = `<div class="orb-content">${data.icon}<br>${data.title}</div>`;
		orb.addEventListener('click', () => openMemoryModal(data));
		orbsContainer.appendChild(orb);
	});
	setupEnhancedInteractions(orbsContainer);
}

function createEnhancedConnections(svg, positions) {
	const gradId = 'orb-connector-gradient';
	const energyGradId = 'energy-gradient';
	
	const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
	
	const grad = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
	grad.setAttribute('id', gradId);
	grad.setAttribute('x1', '0%');
	grad.setAttribute('y1', '0%');
	grad.setAttribute('x2', '100%');
	grad.setAttribute('y2', '0%');
	
	const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	stop1.setAttribute('offset', '0%');
	stop1.setAttribute('stop-color', '#667eea');
	
	const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	stop2.setAttribute('offset', '50%');
	stop2.setAttribute('stop-color', '#764ba2');
	
	const stop3 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	stop3.setAttribute('offset', '100%');
	stop3.setAttribute('stop-color', '#f093fb');
	
	grad.appendChild(stop1);
	grad.appendChild(stop2);
	grad.appendChild(stop3);
	defs.appendChild(grad);

	const energyGrad = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
	energyGrad.setAttribute('id', energyGradId);
	energyGrad.setAttribute('x1', '0%');
	energyGrad.setAttribute('y1', '0%');
	energyGrad.setAttribute('x2', '100%');
	energyGrad.setAttribute('y2', '0%');
	
	const energyStop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	energyStop1.setAttribute('offset', '0%');
	energyStop1.setAttribute('stop-color', '#ffffff');
	energyStop1.setAttribute('stop-opacity', '0');
	
	const energyStop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	energyStop2.setAttribute('offset', '50%');
	energyStop2.setAttribute('stop-color', '#ffffff');
	energyStop2.setAttribute('stop-opacity', '0.8');
	
	const energyStop3 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	energyStop3.setAttribute('offset', '100%');
	energyStop3.setAttribute('stop-color', '#ffffff');
	energyStop3.setAttribute('stop-opacity', '0');
	
	energyGrad.appendChild(energyStop1);
	energyGrad.appendChild(energyStop2);
	energyGrad.appendChild(energyStop3);
	defs.appendChild(energyGrad);

	svg.appendChild(defs);

	for (let i = 0; i < positions.length - 1; i++) {
		const p1 = positions[i];
		const p2 = positions[i + 1];
		const mx = (p1.x + p2.x) / 2;
		const my = (p1.y + p2.y) / 2 - 30;

		const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
		path.setAttribute('d', `M${p1.x},${p1.y} Q${mx},${my} ${p2.x},${p2.y}`);
		path.setAttribute('stroke', `url(#${gradId})`);
		path.setAttribute('stroke-width', '6');
		path.setAttribute('fill', 'none');
		path.setAttribute('opacity', '0.8');
		path.setAttribute('filter', 'drop-shadow(0 0 10px rgba(102, 126, 234, 0.5))');
		svg.appendChild(path);

		const energyPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
		energyPath.setAttribute('d', `M${p1.x},${p1.y} Q${mx},${my} ${p2.x},${p2.y}`);
		energyPath.setAttribute('stroke', `url(#${energyGradId})`);
		energyPath.setAttribute('stroke-width', '2');
		energyPath.setAttribute('fill', 'none');
		energyPath.setAttribute('opacity', '0.6');
		energyPath.style.animation = `energy-flow 3s linear infinite`;
		svg.appendChild(energyPath);
	}
}

function createEnhancedOrbs(container, positions, baseOrbSize) {
	timelineData.forEach((event, idx) => {
		const orb = document.createElement('div');
		orb.className = 'orb';
		
		const sizeVariation = 0.8 + Math.random() * 0.4;
		const currentOrbSize = baseOrbSize * sizeVariation;
		
		orb.style.left = `${positions[idx].x - currentOrbSize / 2}px`;
		orb.style.top = `${positions[idx].y - currentOrbSize / 2}px`;
		orb.style.width = orb.style.height = currentOrbSize + 'px';
		orb.style.zIndex = 10 + idx;
		orb.style.animationDelay = `${0.2 + idx * 0.12}s`;
		
		const gradientAngle = Math.random() * 360;
		orb.style.background = `linear-gradient(${gradientAngle}deg, ${event.color} 0%, ${event.color}dd 50%, ${event.color}aa 100%)`;

		const animations = ['orb-float-individual', 'orb-drift', 'orb-float'];
		const randomAnimation = animations[Math.floor(Math.random() * animations.length)];
		const animationDuration = 4 + Math.random() * 3;
		const animationDelay = Math.random() * 2; 
		
		orb.style.animation = `${randomAnimation} ${animationDuration}s ease-in-out infinite`;
		orb.style.animationDelay = `${animationDelay}s`;

		const content = document.createElement('div');
		content.className = 'orb-content';
		content.innerHTML = `
			<div style="font-size:${0.7 + Math.random() * 0.2}em;font-weight:700;margin-bottom:2px;">${event.icon}</div>
			<div style="font-size:${0.6 + Math.random() * 0.1}em;font-weight:600;">${event.date}</div>
			<div style="font-size:${0.5 + Math.random() * 0.1}em;font-weight:500;">${event.title}</div>
		`;

		orb.appendChild(content);

		orb.addEventListener('mouseenter', () => {
			orb.style.transform = `scale(1.3) translateZ(20px)`;
			orb.style.boxShadow = `
				0 0 80px ${event.color}aa,
				0 0 160px ${event.color}66,
				0 20px 40px rgba(0,0,0,0.4)
			`;
			
			content.innerHTML = `
				<div style="font-size:1em;font-weight:700;margin-bottom:4px;">${event.icon}</div>
				<div style="font-size:0.9em;font-weight:700;">${event.date}</div>
				<div style="font-size:0.8em;font-weight:600;margin-bottom:6px;">${event.title}</div>
				<div style="font-size:0.7em;font-weight:400;line-height:1.3;">${event.desc}</div>
			`;
			
			createParticleBurst(positions[idx].x, positions[idx].y, event.color);
		});

		orb.addEventListener('mouseleave', () => {
			orb.style.transform = '';
			orb.style.boxShadow = '';
			content.innerHTML = `
				<div style="font-size:0.8em;font-weight:700;margin-bottom:2px;">${event.icon}</div>
				<div style="font-size:0.7em;font-weight:600;">${event.date}</div>
				<div style="font-size:0.6em;font-weight:500;">${event.title}</div>
			`;
		});

		orb.addEventListener('click', () => {
			createClickWave(positions[idx].x, positions[idx].y, event.color);
			openMemoryModal(event);
		});

		container.appendChild(orb);
	});
}

function createParticleBurst(x, y, color) {
	for (let i = 0; i < 15; i++) {
		const particle = new Particle(x, y, color);
		particle.vx = (Math.random() - 0.5) * 8;
		particle.vy = (Math.random() - 0.5) * 8;
		particle.life = 1;
		particle.decay = 0.02;
		particles.push(particle);
	}
}

function createClickWave(x, y, color) {
	const wave = document.createElement('div');
	wave.style.position = 'absolute';
	wave.style.left = x + 'px';
	wave.style.top = y + 'px';
	wave.style.width = '0px';
	wave.style.height = '0px';
	wave.style.border = `2px solid ${color}`;
	wave.style.borderRadius = '50%';
	wave.style.transform = 'translate(-50%, -50%)';
	wave.style.opacity = '1';
	wave.style.pointerEvents = 'none';
	wave.style.zIndex = '1000';
	
	document.body.appendChild(wave);
	
	const animation = wave.animate([
		{ width: '0px', height: '0px', opacity: '1' },
		{ width: '200px', height: '200px', opacity: '0' }
	], {
		duration: 1000,
		easing: 'ease-out'
	});
	
	animation.onfinish = () => {
		wave.remove();
	};
}

function setupEnhancedInteractions(container) {
	let mouseTimeout;
	
	container.onmousemove = (e) => {
		isMouseMoving = true;
		const rect = container.getBoundingClientRect();
		mousePosition.x = e.clientX - rect.left;
		mousePosition.y = e.clientY - rect.top;
		
		document.querySelectorAll('.orb').forEach((orb, i) => {
			const mx = (mousePosition.x / rect.width - 0.5) * 2;
			const my = (mousePosition.y / rect.height - 0.5) * 2;
			const intensity = 1 + (i * 0.1);
			
			orb.style.transform = `
				translate3d(0,0,0) 
				scale(${1 + Math.sin(Date.now() * 0.001 + i) * 0.05}) 
				translate(${mx * 20 * intensity}px, ${my * 20 * intensity}px)
				rotateZ(${mx * 5}deg)
			`;
		});
		
		if (Math.random() < 0.3) {
			const particle = new Particle(mousePosition.x, mousePosition.y, '#ffffff');
			particle.size = Math.random() * 2 + 1;
			particle.life = 0.5;
			particle.decay = 0.01;
			particles.push(particle);
		}
		
		clearTimeout(mouseTimeout);
		mouseTimeout = setTimeout(() => {
			isMouseMoving = false;
			document.querySelectorAll('.orb').forEach((orb) => {
				orb.style.transform = '';
			});
		}, 100);
	};
	
	container.onmouseleave = () => {
		isMouseMoving = false;
		document.querySelectorAll('.orb').forEach((orb) => {
			orb.style.transform = '';
		});
	};
}

function openMemoryModal(memoryData) {
	console.log('Opening modal with:', memoryData);

	const modal = document.getElementById('memory-modal');
	const photo = document.getElementById('memory-photo');
	const photoDate = document.getElementById('photo-date');
	const photoTitle = document.getElementById('photo-title');
	const letterTitle = document.getElementById('letter-title');
	const letterContent = document.getElementById('letter-content');
	const letterSignature = document.getElementById('letter-signature');

	if (!modal) {
		console.error('Modal not found!');
		return;
	}

	if (!photo) {
		console.error('Photo element not found!');
		return;
	}

	const parent = photo.parentNode;
	const existingVideos = parent.querySelectorAll('video.memory-photo');
	existingVideos.forEach(v => v.remove());
	photo.src = '';
	photo.alt = '';
	photo.style.display = 'none';

	if (memoryData.photo && memoryData.photo.endsWith('.mp4')) {
		const videoElem = document.createElement('video');
		videoElem.src = memoryData.photo;
		videoElem.className = 'memory-photo';
		videoElem.autoplay = true;
		videoElem.muted = true;
		videoElem.controls = true;
		videoElem.playsInline = true;
		videoElem.loop = true;
		videoElem.style.display = 'block';
		videoElem.style.opacity = '1';
		videoElem.style.visibility = 'visible';
		videoElem.style.width = '100%';
		videoElem.style.height = '100%';
		parent.insertBefore(videoElem, photo);
	} else {	
		const testImg = new Image();
		testImg.onload = function() {
			photo.src = memoryData.photo;
			photo.alt = `${memoryData.title} - ${memoryData.date}`;
			photo.style.display = 'block';
			photo.style.opacity = '1';
			photo.style.visibility = 'visible';
		};
		testImg.onerror = function() {
			const fallbackUrl = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjNjY3ZWVhIi8+Cjx0ZXh0IHg9IjIwMCIgeT0iMzAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyNCIgZm9udC1mYW1pbHk9IkFyaWFsIj5QaG90byBOb3QgRm91bmQ8L3RleHQ+Cjwvc3ZnPgo=';
			photo.src = fallbackUrl;
			photo.alt = `${memoryData.title} - ${memoryData.date} (Photo not found)`;
			photo.style.display = 'block';
			photo.style.opacity = '1';
			photo.style.visibility = 'visible';
		};
		testImg.src = memoryData.photo;
		photo.style.display = 'block';
	}

	photoDate.textContent = memoryData.date;
	photoTitle.textContent = memoryData.title;

	letterTitle.textContent = memoryData.letter.title;
	letterContent.innerHTML = memoryData.letter.content;
	letterSignature.innerHTML = memoryData.letter.signature;

	modal.style.display = 'flex';
	setTimeout(() => {
		modal.classList.add('show');
	}, 10);
}

function closeMemoryModal() {
	const modal = document.getElementById('memory-modal');
	const photo = document.getElementById('memory-photo');
	if (!modal) return;

	if (photo && photo.parentNode) {
		const parent = photo.parentNode;
		const existingVideos = parent.querySelectorAll('video.memory-photo');
		existingVideos.forEach(v => v.remove());
		photo.src = '';
		photo.alt = '';
		photo.style.display = 'none';
	}

	modal.classList.remove('show');
	setTimeout(() => {
		modal.style.display = 'none';
	}, 300);
}

function setupMemoryModal() {
	const modal = document.getElementById('memory-modal');
	const closeBtn = document.getElementById('close-memory');
	const backdrop = modal.querySelector('.memory-backdrop');
	
	if (!modal || !closeBtn) return;
	
	closeBtn.addEventListener('click', closeMemoryModal);
	backdrop.addEventListener('click', closeMemoryModal);
	
	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape' && modal.classList.contains('show')) {
			closeMemoryModal();
		}
	});
}

function setupIntroModal() {
	const modal = document.getElementById('intro-modal');
	const closeBtn = document.getElementById('close-intro');
	
	if (!modal || !closeBtn) return;
	
	closeBtn.addEventListener('click', () => {
		modal.classList.add('hide');
		
		for (let i = 0; i < 30; i++) {
			const particle = new Particle(
				window.innerWidth / 2,
				window.innerHeight / 2,
				'#667eea'
			);
			particle.vx = (Math.random() - 0.5) * 10;
			particle.vy = (Math.random() - 0.5) * 10;
			particles.push(particle);
		}
		
		setTimeout(() => { 
			modal.style.display = 'none'; 
		}, 800);
	});
	
	closeBtn.addEventListener('mouseenter', () => {
		closeBtn.style.transform = 'translateY(-3px) scale(1.05)';
	});
	
	closeBtn.addEventListener('mouseleave', () => {
		closeBtn.style.transform = '';
	});
}

function animateParticles() {
  const container = document.getElementById('particles');
  if (!container) return;
  container.innerHTML = '';
  const numParticles = Math.floor(window.innerWidth / 8);
  for (let i = 0; i < numParticles; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.left = Math.random() * 100 + '%';
    p.style.animationDuration = (6 + Math.random() * 6) + 's';
    p.style.animationDelay = (-Math.random() * 8) + 's';
    p.style.opacity = 0.3 + Math.random() * 0.7;
    container.appendChild(p);
  }
}

function addDynamicStyles() {
	const style = document.createElement('style');
	style.textContent = `
		@keyframes energy-flow {
			0% { stroke-dasharray: 0 1000; }
			100% { stroke-dasharray: 1000 0; }
		}
		
		.orb {
			transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
		}
		
		.orb:hover {
			animation-play-state: paused;
		}
	`;
	document.head.appendChild(style);
}

function init() {
	createFloatingParticles();
	render3DTimeline();
	setupIntroModal();
	addDynamicStyles();
	animateParticles();
	
	window.addEventListener('resize', () => {
		clearTimeout(window.resizeTimeout);
		window.resizeTimeout = setTimeout(render3DTimeline, 250);
	});
	

	const scrollIndicator = document.querySelector('.scroll-indicator');
	if (scrollIndicator) {
		setTimeout(() => {
			scrollIndicator.style.opacity = '0';
		}, 5000);
	}
}

function showLoadingScreen() {
	const loadingScreen = document.getElementById('loading-screen');
	if (!loadingScreen) return;
	
	setTimeout(() => {
		loadingScreen.classList.add('hide');
		setTimeout(() => {
			loadingScreen.style.display = 'none';
		}, 500);
	}, 2000);
}

function init() {
	createFloatingParticles();
	render3DTimeline();
	setupIntroModal();
	setupMemoryModal();
	addDynamicStyles();
	animateParticles();
	
	window.addEventListener('resize', () => {
		clearTimeout(window.resizeTimeout);
		window.resizeTimeout = setTimeout(() => {
			animateParticles();
			render3DTimeline();
		}, 250);
	});
}

window.addEventListener('DOMContentLoaded', () => {
	showLoadingScreen();
	
	setTimeout(() => {
		init();
	}, 2500);
});

window.addEventListener('beforeunload', () => {
	if (animationFrameId) {
		cancelAnimationFrame(animationFrameId);
	}
});
