const timelineData = [
	{
		date: 'May 18, 2025',
		title: 'First Picture',
		desc: "Ito talaga yung picture na hindi ko makakalimutan.",
		color: '#667eea',
		icon: '👀',
		photo: '1st/main/photos/firstPic.jpeg',
		letter: {
			title: 'The Beginning HAHAHA',
			content: `Hello baby,<br><br>
			This picture was the beginning,
			imagine, dito nagsimula ang lahat HAHAHAHA.
			From the very first time I saw you, I already knew you were special,
			so precious to me, and that’s why I’ve always treated you like my princess.<br><br>
			oa na kung oa pero totoo yon HAHAHA.
			'di ako mag eeffort maggawa ng napaka tagal at napaka hirap na handmade na flower kung eme eme lang yan aa naman`,
			signature: 'Lloydiee :33💕'
		}
	},

	{
		date: 'June 19, 2025',
		title: 'First Meet',
		desc: 'First meet na parang HAHAHAHA',
		color: '#764ba2',
		icon: '🌸',
		photo: '1st/main/photos/firstPhotobooth.jpg',
		letter: {
			title: 'First Ever Meet',
			content: `First meet, lasts!<br><br>
			This was our very first photobooth together, 
			look how close we were kahit first time pa lang.
			I want our first meet to be memorable, alam mo naman yan kasi lagi ko nababanggit, and
			I hope naging memorable din sayo ang first meet natin. <br><br>
			And also, I believe that a good first meet really lasts.
			What I mean is, if the first meet is boring or awkward, paano pa masusundan, right?
			Kaya ayun, I’m so happy, and I hope you are too hehe.`,
			signature: 'Lloydiee :33💕'
		}
	},

	{
		date: 'July 14, 2025',
		title: 'Second Meet',
		desc: 'Second meet na nakita pa sila Frian :))',
		color: '#f093fb',
		icon: '🤭',
		photo: '1st/main/photos/2ndbooth.jpg',
		letter: {
			title: 'Second Meet',
			content: `The Angle I Want,<br><br>
			This was the time you came to Lipa and all I can say is I felt so special, 
			especially when you mentioned that you never really visited your past dates. 
			Then one time, nag-usap tayo and I found out na kaya ka pala nagpunta sa SM Lipa 
			was not really for me, kundi gusto mo lang pala gumala HAHHAHAHA.<br><br>
			But anyways, masaya pa rin ako kahit ganon yung na fefeel mo,
			nakapag pictrue tayo ng angle na gusto ko hehe. 
			Na-meet pa natin si Frian at ang bebe niya nang biglaan, nagkaroon pa ng biglaang business partner e.`,
			signature: 'Lloydiee :33💕'
		}
	},
	
	
	{
		date: 'July 14, 2025',
		title: 'Yogurt Date!',
		desc: 'Still in SM with you',
		color: '#4facfe',
		icon: '🍨',
		photo: '1st/main/photos/yogurtSM.jpg',
		letter: {
			title: 'Yogurt with You',
			content: `Last meet na ba?<br><br>
			I really thought this is last time for us. After we stopped talking, 
			I just kept looking at this photo, 'cause look at how happy we were in this moment, 
			it felt so genuine to me. <br><br>
			This was also the time when we talked about life and how we adjust whenever we're together, 
			since we have different attitudes and perspectives in life, kaya it feels so different.`,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'August 7, 2025',
		title: 'BFC Comeback?',
		desc: "Guess what, we're back HAHAHA",
		color: '#43e97b',
		icon: '💕',
		photo: '1st/main/photos/ukay.jpeg',
		letter: {
			title: "Who would've thought?",
			content: `Mala Daniel Caesar e,<br><br>	
			Who would've thought nga naman na masusundan pa pala yung second meet natin?
			'Di ko talaga in-expect na mangyayari yun, given everything you told me. 
			It was August 4, 2025, 12:38AM, biglang tumibok ng mabilis yung puso ko dahil sa kaba HAHAHAHA.
			bigla-bigla ka na lang nag-chat e.<br><br>
			Anyways, eto yung time na parang bumalik lahat ng saya sa akin, na para bang HAHAHAHA.
			na fefeel ko na baka mag wowork this time kasi iba talaga yung pakiramdam e,
			na parang we’re both doing better this time.<br><br>
			Thank you for taking the risk with me, Joey.`,
			signature: 'Lloydiee :33💕'
		}
	},
	
	{
		date: 'August 13, 2025',
		title: 'Your Birthday!',
		desc: 'Her birthday with her friends.',
		color: '#fa709a',
		icon: '🎂',
		photo: '1st/main/photos/herBirthday.jpeg',
		letter: {
			title: `It's your day!`,
			content: `So gorgeous!<br><br>
			It’s your birthday, sadly wala ako to celebrate with you kasi may class ako, 
			but still, you had your friends to celebrate with. May nag-surprise pa nga sayo 
			at nag-effort talaga silang lahat. 
			Swerte mo sa friends, love them the way you love yourself, and of course, love me differently 😝 <br><br>
			I know you won’t believe me when I say you’re so pretty, gorgeous, beautiful, etc., 
			kasi ayaw mo ng ganong compliments, pero kasi it’s the truth e. 
			Look at the picture on the left side, tamo, apaka GORGEOUS!! 
			Swerte ko naman na ganyan ka-ganda ang Girlfriend ko.<br><br>
			Sasabihan mo na naman ako ng “iww”, “oa” HAHAHAHAHHA, basang-basa ko na galawan mo e.`,
			signature: 'Lloydiee :33💕'
		}
	},
	{
		date: 'August 16, 2025',
		title: 'Still her Birthday?!',
		desc: 'Simple celebration with just us two.',
		color: '#ff6b6b',
		icon: '☕',
		photo: '1st/main/photos/askher.jpeg',
		letter: {
			title: 'Still your Birthday',
			content: `The Beginning ba ulit? HAHAHA<br><br>
			This was the time we went out for a date to have a late celebration for your birthday.  
			Every time we go out, it always feels so special walang dull moments with you e. 
			Parang ayoko na umuwi sa amin kapag ikaw yung pinupuntahan ko or kapag kasama kita, huhu.<br><br>
			This was also the day I asked you something with the letter I gave you, 
			and you said “bad move.” Late ko na lang na-realize, “shet oo nga 'no” HAHAHAHA.<br><br>
			Eto rin yung time na inihatid mo ako pauwi. Dapat mabilis lang kasi pahapon na, 
			but umabot na ng gabi hanggang sa hindi na ako pinauwi at nakitulog na lang ako sa inyo aa huhu.  
			But anyways, I’M SUPER HAPPY kasi you brought me home like sobrang assurance na yon for me.`,
			signature: 'Lloydiee :33💕'
		}
	},
	
	{
		date: 'August 16, 2025',
		title: 'Home Run?',
		desc: 'First time ever in my life mai-uwi mwehehe',
		color: '#4ecdc4',
		icon: '🏠',
		photo: '1st/main/photos/herHome.mp4',
		letter: {
			title: 'One Year of Magic',
			content: `My anniversary love,<br><br>
			One year of you, one year of us, one year of the most beautiful love story I could have ever imagined. Every day with you has been a gift, every moment a treasure.<br><br>
			We've laughed together, cried together, grown together, and loved together. You've made every ordinary day extraordinary, every moment magical.<br><br>
			Here's to our first year and to many, many more years of love ahead.`,
			signature: 'Your anniversary sweetheart 🎂💖'
		}
	},
	{
		date: 'August 16, 2025',
		title: 'With Suzy!',
		desc: 'Picture with Suzy cutieee',
		color: '#45b7d1',
		icon: '🐾',
		photo: '1st/main/photos/withSuzy.jpeg',
		letter: {
			title: 'Celebrating Us',
			content: `My celebration, my joy,<br><br>
			This milestone wasn't just about what we achieved - it was about celebrating who we've become together. Every challenge we've faced, every dream we've chased, every moment we've shared has led us here.<br><br>
			I'm so proud of us, of our journey, of the love we've built. You've been my biggest cheerleader, my greatest supporter, and my most beautiful inspiration.<br><br>
			Here's to many more celebrations together, my love.`,
			signature: 'Your proudest supporter 🎉💖'
		}
	},
	{
		date: 'August 23, 2025',
		title: 'Flowers',
		desc: 'Cute flowers for her!',
		color: '#96ceb4',
		icon: '🌺',
		photo: '1st/main/photos/flowers.jpg',
		letter: {
			title: 'Growing in Love',
			content: `My growing love,<br><br>
			Like a beautiful garden, our love keeps growing stronger, deeper, more beautiful with each passing day. We've learned to nurture each other, to grow together, to bloom in each other's light.<br><br>
			Every challenge has made us stronger, every joy has made us happier, every moment has made us more in love. We're not just growing older together - we're growing better together.<br><br>
			Thank you for growing with me, for growing into the most amazing partner I could have ever dreamed of.`,
			signature: 'Your growing love 🌱💕'
		}
	},
	{
		date: 'August 23, 2025',
		title: 'Home Run Again??',
		desc: 'OTW sa amin HAAHHHA',
		color: '#feca57',
		icon: '🚗',
		photo: '1st/main/photos/carFave.jpg',
		letter: {
			title: 'Forever & Always',
			content: `My forever, my always,<br><br>
			Today, tomorrow, and every day after - I choose you. I choose us. I choose this beautiful life we've built together, filled with love, laughter, and endless possibilities.<br><br>
			Every morning I wake up grateful that you're mine, every night I fall asleep dreaming of our future together. You are my greatest adventure, my sweetest dream, my most beautiful reality.<br><br>
			I love you more than words can say, more than time can measure, more than forever can hold.`,
			signature: 'Yours forever and always 💖✨'
		}
	},
	{
		date: 'August 23, 2025',
		title: 'Touch down HAHA',
		desc: 'Shy type e nung nasa amin na HAHAHA',
		color: '#ff9ff3',
		icon: '🏡',
		photo: '1st/main/photos/samin.mp4',
		letter: {
			title: 'Your Laugh',
			content: `My joy, my happiness,<br><br>
			That first time I made you laugh - really laugh - it was like discovering the most beautiful melody in the world. Your laugh became my favorite sound, my daily dose of happiness.<br><br>
			I love how your eyes crinkle when you laugh, how you throw your head back, how contagious your joy is. Making you laugh became my favorite hobby, my greatest achievement.<br><br>
			Thank you for sharing your laughter with me.`,
			signature: 'Your comedian 😂💕'
		}
	},
	{
		date: 'August 23, 2025',
		title: 'Family Lunch',
		desc: 'Meet my family and eat lunch with them',
		color: '#ff6b6b',
		icon: '💕',
		photo: '1st/main/photos/fam2.jpg',
		letter: {
			title: 'Stronger Together',
			content: `My partner in growth,<br><br>
			Our first fight taught me that love isn't about never disagreeing - it's about how we work through our differences together. You showed me that conflict can bring us closer when handled with love and respect.<br><br>
			I learned that we're stronger together, even when we disagree. You taught me that love means choosing us over being right, choosing understanding over winning.<br><br>
			Thank you for teaching me how to love better.`,
			signature: 'Your growing partner 🤝❤️'
		}
	},
	{
		date: 'August 23, 2025',
		title: 'Photobooth w/ thrill?',
		desc: 'Photo booth for the month of August',
		color: '#a8e6cf',
		icon: '🫣',
		photo: '1st/main/photos/photoSM.mp4',
		letter: {
			title: 'Your Surprise',
			content: `My beautiful surprise,<br><br>
			Planning that first surprise for you was one of my favorite memories. The anticipation, the excitement, the way your face lit up when you realized what was happening - pure magic.<br><br>
			I love how you react to surprises, how your eyes sparkle with wonder, how you get that adorable look of disbelief. Making you happy became my greatest joy.<br><br>
			Here's to many more surprises and the joy they bring us both.`,
			signature: 'Your surprise planner 🎁✨'
		}
	},
	{
		date: 'august 23, 2025',
		title: 'Four couples!',
		desc: 'Picuture with four couples',
		color: '#ffd93d',
		icon: '🫘',
		photo: '1st/main/photos/withBrother.jpeg',
		letter: {
			title: 'Our Little Family',
			content: `My co-parent,<br><br>
			The day we brought home our first pet together, I knew our family was growing. Watching you care for our little one with such love and tenderness made me fall in love with you all over again.<br><br>
			You're such a natural caregiver, so patient and loving. Our pet became another way we bonded, another shared responsibility that brought us closer together.<br><br>
			Thank you for being such an amazing co-parent to our furry family member.`,
			signature: 'Your co-parent 🐾💕'
		}
	},
	{
		date: 'August 23, 2025',
		title: 'Shy type HAHAH',
		desc: 'pipic lang e nahiya pa yan sha',
		color: '#ff8a80',
		icon: '🎀',
		photo: '1st/main/photos/shyCoffeebeans.jpg',
		letter: {
			title: 'Holiday Magic',
			content: `My holiday love,<br><br>
			Our first holiday together was magical. Decorating, cooking, creating traditions - everything felt more special because we were doing it together. You made the holidays feel like home.<br><br>
			I love how you get excited about traditions, how you make everything feel festive and warm. Our holiday celebrations became some of my favorite memories.<br><br>
			Thank you for making every holiday magical and meaningful.`,
			signature: 'Your holiday partner 🎄💖'
		}
	},
	{
		date: 'August 30, 2025',
		title: 'Samgy date<33',
		desc: 'Samgy date na para bang hindi diet HAHAHAHA',
		color: '#81c784',
		icon: '🥓🥬🍚',
		photo: '1st/main/photos/samgy.mp4',
		letter: {
			title: 'Teamwork Makes the Dream Work',
			content: `My project partner,<br><br>
			Working on our first big project together showed me how well we complement each other. Your creativity, my organization, your vision, my execution - we make an amazing team.<br><br>
			I love how we problem-solve together, how we support each other through challenges, how we celebrate our successes as a team. We're unstoppable when we work together.<br><br>
			Thank you for being my perfect partner in everything we do.`,
			signature: 'Your teammate 🔨💪'
		}
	},
	{
		date: 'September 6, 2025',
		title: "She's mine!",
		desc: 'The day i will never forget!',
		color: '#64b5f6',
		icon: '💞',
		photo: '1st/main/photos/saidYes.mp4',
		letter: {
			title: 'Adventure Awaits',
			content: `My adventure buddy,<br><br>
			Our first big adventure together was everything I dreamed it would be. The planning, the excitement, the unexpected moments, the memories we made - it was perfect because we did it together.<br><br>
			I love how you embrace new experiences, how you find joy in the journey, how you make every adventure feel like a grand exploration. With you, every day is an adventure.<br><br>
			Here's to many more adventures and the stories we'll tell.`,
			signature: 'Your adventure partner 🗺️🌟'
		}
	},
	{
		date: 'September 6, 2025',
		title: 'Date with her',
		desc: 'All the dreams we have for our future together.',
		color: '#ba68c8',
		icon: '🥰',
		photo: '1st/main/photos/yesyes.jpg',
		letter: {
			title: 'Our Future',
			content: `My dream partner,<br><br>
			Dreaming about our future together is one of my favorite things to do. All the places we'll go, the experiences we'll have, the memories we'll make - I can't wait to live them all with you.<br><br>
			Your dreams have become my dreams, your goals my goals. Together, we can achieve anything we set our minds to. Our future is bright because we're facing it together.<br><br>
			Thank you for sharing your dreams with me and making them ours.`,
			signature: 'Your future 💫🌈'
		}
	},
	{
		date: 'September 13, 2025',
		title: 'Far from home?!',
		desc: 'PG to LB HAHHAHAHA',
		color: '#ffb347',
		icon: '🍓',
		photo: '1st/main/photos/swing.jpg',
		letter: {
			title: 'Cuddle & Popcorn',
			content: `Our first movie night was so cozy. I loved every minute snuggled up with you, laughing and sharing popcorn. Can't wait for more!`,
			signature: 'Your movie buddy 🍿'
		}
	},
	{
		date: 'September 13, 2025',
		title: 'Fave live photo',
		desc: 'Tampo pa yan sha HAHAHHA',
		color: '#6dd5ed',
		icon: '💗ྀི',
		photo: '1st/main/photos/tampo.mp4',
		letter: {
			title: 'Tampo tampuhan e HAHAHHA',
			content: `Who knew rain could be so much fun? Dancing with you in the rain made me feel alive and free. Let's never stop being silly together!`,
			signature: 'Your rain dancer ☔'
		}
	},
	{
		date: 'September 13, 2025',
		title: 'Candid picture',
		desc: 'A candid picture with her',
		color: '#b388ff',
		icon: '📸',
		photo: '1st/main/photos/back.png',
		letter: {
			title: 'Coffee & Conversations',
			content: `Our coffee date was filled with laughter and deep talks. I love discovering new places and new things about you.`,
			signature: 'Your coffee mate 💜'
		}
	},
	{
		date: 'September 20, 2025',
		title: 'S&R Salad!',
		desc: 'Before the sakuna(massage na napakasakit)',
		color: '#ff6e7f',
		icon: '🥗',
		photo: '1st/main/photos/pizzaSalad.jpg',
		letter: {
			title: 'Chasing Sunsets',
			content: `The sunset was beautiful, but nothing compares to sharing it with you. Thank you for making every moment magical.`,
			signature: 'Your sunset chaser 🌇'
		}
	},
	{
		date: 'September 20, 2025',
		title: 'Another coffee date',
		desc: 'A quality time with her',
		color: '#43cea2',
		icon: '☕',
		photo: '1st/main/photos/walter.jpg',
		letter: {
			title: 'A Little Surprise',
			content: `Seeing your smile when you got my surprise made my day. I love making you happy!`,
			signature: 'Your secret gifter 🎉'
		}
	}
];
let particles = [];
let isMouseMoving = false;
let mousePosition = { x: 0, y: 0 };
let animationFrameId = null;

class Particle {
	constructor(x, y, color = '#ffffff') {
		this.x = x;
		this.y = y;
		this.vx = (Math.random() - 0.5) * 2;
		this.vy = (Math.random() - 0.5) * 2;
		this.life = 1;
		this.decay = Math.random() * 0.02 + 0.005;
		this.size = Math.random() * 3 + 1;
		this.color = color;
		this.opacity = Math.random() * 0.8 + 0.2;
	}

	update() {
		this.x += this.vx;
		this.y += this.vy;
		this.life -= this.decay;
		this.opacity = this.life * 0.8;
		this.vx *= 0.98;
		this.vy *= 0.98;
	}

	draw(ctx) {
		ctx.save();
		ctx.globalAlpha = this.opacity;
		ctx.fillStyle = this.color;
		ctx.beginPath();
		ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
		ctx.fill();
		ctx.restore();
	}

	isDead() {
		return this.life <= 0;
	}
}

function createFloatingParticles() {
	const particlesContainer = document.getElementById('particles');
	if (!particlesContainer) return;

	for (let i = 0; i < 50; i++) {
		const particle = document.createElement('div');
		particle.className = 'particle';
		particle.style.left = Math.random() * 100 + '%';
		particle.style.animationDelay = Math.random() * 8 + 's';
		particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
		particlesContainer.appendChild(particle);
	}
}

function render3DTimeline() {
	const orbsContainer = document.getElementById('timeline-orbs');
	if (!orbsContainer) return;

	orbsContainer.innerHTML = '';

	orbsContainer.innerHTML = '';
	const baseOrbSize = 80;
	timelineData.forEach((data, i) => {
		const orb = document.createElement('div');
		orb.className = 'orb';
		orb.style.marginTop = (i % 2 === 0) ? '0px' : '40px';
		orb.style.marginBottom = (i % 2 === 0) ? '40px' : '0px';
		orb.style.width = baseOrbSize + 'px';
		orb.style.height = baseOrbSize + 'px';
		orb.style.background = `linear-gradient(135deg, ${data.color} 0%, #764ba2 100%)`;
		orb.innerHTML = `<div class="orb-content">${data.icon}<br>${data.title}</div>`;
		orb.addEventListener('click', () => openMemoryModal(data));
		orbsContainer.appendChild(orb);
	});
	setupEnhancedInteractions(orbsContainer);
}

function createEnhancedConnections(svg, positions) {
	const gradId = 'orb-connector-gradient';
	const energyGradId = 'energy-gradient';
	
	const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
	
	const grad = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
	grad.setAttribute('id', gradId);
	grad.setAttribute('x1', '0%');
	grad.setAttribute('y1', '0%');
	grad.setAttribute('x2', '100%');
	grad.setAttribute('y2', '0%');
	
	const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	stop1.setAttribute('offset', '0%');
	stop1.setAttribute('stop-color', '#667eea');
	
	const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	stop2.setAttribute('offset', '50%');
	stop2.setAttribute('stop-color', '#764ba2');
	
	const stop3 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	stop3.setAttribute('offset', '100%');
	stop3.setAttribute('stop-color', '#f093fb');
	
	grad.appendChild(stop1);
	grad.appendChild(stop2);
	grad.appendChild(stop3);
	defs.appendChild(grad);

	const energyGrad = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
	energyGrad.setAttribute('id', energyGradId);
	energyGrad.setAttribute('x1', '0%');
	energyGrad.setAttribute('y1', '0%');
	energyGrad.setAttribute('x2', '100%');
	energyGrad.setAttribute('y2', '0%');
	
	const energyStop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	energyStop1.setAttribute('offset', '0%');
	energyStop1.setAttribute('stop-color', '#ffffff');
	energyStop1.setAttribute('stop-opacity', '0');
	
	const energyStop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	energyStop2.setAttribute('offset', '50%');
	energyStop2.setAttribute('stop-color', '#ffffff');
	energyStop2.setAttribute('stop-opacity', '0.8');
	
	const energyStop3 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
	energyStop3.setAttribute('offset', '100%');
	energyStop3.setAttribute('stop-color', '#ffffff');
	energyStop3.setAttribute('stop-opacity', '0');
	
	energyGrad.appendChild(energyStop1);
	energyGrad.appendChild(energyStop2);
	energyGrad.appendChild(energyStop3);
	defs.appendChild(energyGrad);

	svg.appendChild(defs);

	for (let i = 0; i < positions.length - 1; i++) {
		const p1 = positions[i];
		const p2 = positions[i + 1];
		const mx = (p1.x + p2.x) / 2;
		const my = (p1.y + p2.y) / 2 - 30;

		const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
		path.setAttribute('d', `M${p1.x},${p1.y} Q${mx},${my} ${p2.x},${p2.y}`);
		path.setAttribute('stroke', `url(#${gradId})`);
		path.setAttribute('stroke-width', '6');
		path.setAttribute('fill', 'none');
		path.setAttribute('opacity', '0.8');
		path.setAttribute('filter', 'drop-shadow(0 0 10px rgba(102, 126, 234, 0.5))');
		svg.appendChild(path);

		const energyPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
		energyPath.setAttribute('d', `M${p1.x},${p1.y} Q${mx},${my} ${p2.x},${p2.y}`);
		energyPath.setAttribute('stroke', `url(#${energyGradId})`);
		energyPath.setAttribute('stroke-width', '2');
		energyPath.setAttribute('fill', 'none');
		energyPath.setAttribute('opacity', '0.6');
		energyPath.style.animation = `energy-flow 3s linear infinite`;
		svg.appendChild(energyPath);
	}
}

function createEnhancedOrbs(container, positions, baseOrbSize) {
	timelineData.forEach((event, idx) => {
		const orb = document.createElement('div');
		orb.className = 'orb';
		
		const sizeVariation = 0.8 + Math.random() * 0.4;
		const currentOrbSize = baseOrbSize * sizeVariation;
		
		orb.style.left = `${positions[idx].x - currentOrbSize / 2}px`;
		orb.style.top = `${positions[idx].y - currentOrbSize / 2}px`;
		orb.style.width = orb.style.height = currentOrbSize + 'px';
		orb.style.zIndex = 10 + idx;
		orb.style.animationDelay = `${0.2 + idx * 0.12}s`;
		
		const gradientAngle = Math.random() * 360;
		orb.style.background = `linear-gradient(${gradientAngle}deg, ${event.color} 0%, ${event.color}dd 50%, ${event.color}aa 100%)`;

		const animations = ['orb-float-individual', 'orb-drift', 'orb-float'];
		const randomAnimation = animations[Math.floor(Math.random() * animations.length)];
		const animationDuration = 4 + Math.random() * 3;
		const animationDelay = Math.random() * 2; 
		
		orb.style.animation = `${randomAnimation} ${animationDuration}s ease-in-out infinite`;
		orb.style.animationDelay = `${animationDelay}s`;

		const content = document.createElement('div');
		content.className = 'orb-content';
		content.innerHTML = `
			<div style="font-size:${0.7 + Math.random() * 0.2}em;font-weight:700;margin-bottom:2px;">${event.icon}</div>
			<div style="font-size:${0.6 + Math.random() * 0.1}em;font-weight:600;">${event.date}</div>
			<div style="font-size:${0.5 + Math.random() * 0.1}em;font-weight:500;">${event.title}</div>
		`;

		orb.appendChild(content);

		orb.addEventListener('mouseenter', () => {
			orb.style.transform = `scale(1.3) translateZ(20px)`;
			orb.style.boxShadow = `
				0 0 80px ${event.color}aa,
				0 0 160px ${event.color}66,
				0 20px 40px rgba(0,0,0,0.4)
			`;
			
			content.innerHTML = `
				<div style="font-size:1em;font-weight:700;margin-bottom:4px;">${event.icon}</div>
				<div style="font-size:0.9em;font-weight:700;">${event.date}</div>
				<div style="font-size:0.8em;font-weight:600;margin-bottom:6px;">${event.title}</div>
				<div style="font-size:0.7em;font-weight:400;line-height:1.3;">${event.desc}</div>
			`;
			
			createParticleBurst(positions[idx].x, positions[idx].y, event.color);
		});

		orb.addEventListener('mouseleave', () => {
			orb.style.transform = '';
			orb.style.boxShadow = '';
			content.innerHTML = `
				<div style="font-size:0.8em;font-weight:700;margin-bottom:2px;">${event.icon}</div>
				<div style="font-size:0.7em;font-weight:600;">${event.date}</div>
				<div style="font-size:0.6em;font-weight:500;">${event.title}</div>
			`;
		});

		orb.addEventListener('click', () => {
			createClickWave(positions[idx].x, positions[idx].y, event.color);
			openMemoryModal(event);
		});

		container.appendChild(orb);
	});
}

function createParticleBurst(x, y, color) {
	for (let i = 0; i < 15; i++) {
		const particle = new Particle(x, y, color);
		particle.vx = (Math.random() - 0.5) * 8;
		particle.vy = (Math.random() - 0.5) * 8;
		particle.life = 1;
		particle.decay = 0.02;
		particles.push(particle);
	}
}

function createClickWave(x, y, color) {
	const wave = document.createElement('div');
	wave.style.position = 'absolute';
	wave.style.left = x + 'px';
	wave.style.top = y + 'px';
	wave.style.width = '0px';
	wave.style.height = '0px';
	wave.style.border = `2px solid ${color}`;
	wave.style.borderRadius = '50%';
	wave.style.transform = 'translate(-50%, -50%)';
	wave.style.opacity = '1';
	wave.style.pointerEvents = 'none';
	wave.style.zIndex = '1000';
	
	document.body.appendChild(wave);
	
	const animation = wave.animate([
		{ width: '0px', height: '0px', opacity: '1' },
		{ width: '200px', height: '200px', opacity: '0' }
	], {
		duration: 1000,
		easing: 'ease-out'
	});
	
	animation.onfinish = () => {
		wave.remove();
	};
}

function setupEnhancedInteractions(container) {
	let mouseTimeout;
	
	container.onmousemove = (e) => {
		isMouseMoving = true;
		const rect = container.getBoundingClientRect();
		mousePosition.x = e.clientX - rect.left;
		mousePosition.y = e.clientY - rect.top;
		
		document.querySelectorAll('.orb').forEach((orb, i) => {
			const mx = (mousePosition.x / rect.width - 0.5) * 2;
			const my = (mousePosition.y / rect.height - 0.5) * 2;
			const intensity = 1 + (i * 0.1);
			
			orb.style.transform = `
				translate3d(0,0,0) 
				scale(${1 + Math.sin(Date.now() * 0.001 + i) * 0.05}) 
				translate(${mx * 20 * intensity}px, ${my * 20 * intensity}px)
				rotateZ(${mx * 5}deg)
			`;
		});
		
		if (Math.random() < 0.3) {
			const particle = new Particle(mousePosition.x, mousePosition.y, '#ffffff');
			particle.size = Math.random() * 2 + 1;
			particle.life = 0.5;
			particle.decay = 0.01;
			particles.push(particle);
		}
		
		clearTimeout(mouseTimeout);
		mouseTimeout = setTimeout(() => {
			isMouseMoving = false;
			document.querySelectorAll('.orb').forEach((orb) => {
				orb.style.transform = '';
			});
		}, 100);
	};
	
	container.onmouseleave = () => {
		isMouseMoving = false;
		document.querySelectorAll('.orb').forEach((orb) => {
			orb.style.transform = '';
		});
	};
}

function openMemoryModal(memoryData) {
	console.log('Opening modal with:', memoryData);

	const modal = document.getElementById('memory-modal');
	const photo = document.getElementById('memory-photo');
	const photoDate = document.getElementById('photo-date');
	const photoTitle = document.getElementById('photo-title');
	const letterTitle = document.getElementById('letter-title');
	const letterContent = document.getElementById('letter-content');
	const letterSignature = document.getElementById('letter-signature');

	if (!modal) {
		console.error('Modal not found!');
		return;
	}

	if (!photo) {
		console.error('Photo element not found!');
		return;
	}

	const parent = photo.parentNode;
	const existingVideos = parent.querySelectorAll('video.memory-photo');
	existingVideos.forEach(v => v.remove());
	photo.src = '';
	photo.alt = '';
	photo.style.display = 'none';

	if (memoryData.photo && memoryData.photo.endsWith('.mp4')) {
		const videoElem = document.createElement('video');
		videoElem.src = memoryData.photo;
		videoElem.className = 'memory-photo';
		videoElem.autoplay = true;
		videoElem.muted = true;
		videoElem.controls = true;
		videoElem.playsInline = true;
		videoElem.loop = true;
		videoElem.style.display = 'block';
		videoElem.style.opacity = '1';
		videoElem.style.visibility = 'visible';
		videoElem.style.width = '100%';
		videoElem.style.height = '100%';
		parent.insertBefore(videoElem, photo);
	} else {	
		const testImg = new Image();
		testImg.onload = function() {
			photo.src = memoryData.photo;
			photo.alt = `${memoryData.title} - ${memoryData.date}`;
			photo.style.display = 'block';
			photo.style.opacity = '1';
			photo.style.visibility = 'visible';
		};
		testImg.onerror = function() {
			const fallbackUrl = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwMCIgdmlld0JveD0iMCAwIDQwMCA2MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjNjY3ZWVhIi8+Cjx0ZXh0IHg9IjIwMCIgeT0iMzAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyNCIgZm9udC1mYW1pbHk9IkFyaWFsIj5QaG90byBOb3QgRm91bmQ8L3RleHQ+Cjwvc3ZnPgo=';
			photo.src = fallbackUrl;
			photo.alt = `${memoryData.title} - ${memoryData.date} (Photo not found)`;
			photo.style.display = 'block';
			photo.style.opacity = '1';
			photo.style.visibility = 'visible';
		};
		testImg.src = memoryData.photo;
		photo.style.display = 'block';
	}

	photoDate.textContent = memoryData.date;
	photoTitle.textContent = memoryData.title;

	letterTitle.textContent = memoryData.letter.title;
	letterContent.innerHTML = memoryData.letter.content;
	letterSignature.innerHTML = memoryData.letter.signature;

	modal.style.display = 'flex';
	setTimeout(() => {
		modal.classList.add('show');
	}, 10);
}

function closeMemoryModal() {
	const modal = document.getElementById('memory-modal');
	const photo = document.getElementById('memory-photo');
	if (!modal) return;

	if (photo && photo.parentNode) {
		const parent = photo.parentNode;
		const existingVideos = parent.querySelectorAll('video.memory-photo');
		existingVideos.forEach(v => v.remove());
		photo.src = '';
		photo.alt = '';
		photo.style.display = 'none';
	}

	modal.classList.remove('show');
	setTimeout(() => {
		modal.style.display = 'none';
	}, 300);
}

function setupMemoryModal() {
	const modal = document.getElementById('memory-modal');
	const closeBtn = document.getElementById('close-memory');
	const backdrop = modal.querySelector('.memory-backdrop');
	
	if (!modal || !closeBtn) return;
	
	closeBtn.addEventListener('click', closeMemoryModal);
	backdrop.addEventListener('click', closeMemoryModal);
	
	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape' && modal.classList.contains('show')) {
			closeMemoryModal();
		}
	});
}

function setupIntroModal() {
	const modal = document.getElementById('intro-modal');
	const closeBtn = document.getElementById('close-intro');
	
	if (!modal || !closeBtn) return;
	
	closeBtn.addEventListener('click', () => {
		modal.classList.add('hide');
		
		for (let i = 0; i < 30; i++) {
			const particle = new Particle(
				window.innerWidth / 2,
				window.innerHeight / 2,
				'#667eea'
			);
			particle.vx = (Math.random() - 0.5) * 10;
			particle.vy = (Math.random() - 0.5) * 10;
			particles.push(particle);
		}
		
		setTimeout(() => { 
			modal.style.display = 'none'; 
		}, 800);
	});
	
	closeBtn.addEventListener('mouseenter', () => {
		closeBtn.style.transform = 'translateY(-3px) scale(1.05)';
	});
	
	closeBtn.addEventListener('mouseleave', () => {
		closeBtn.style.transform = '';
	});
}

function animateParticles() {
  const container = document.getElementById('particles');
  if (!container) return;
  container.innerHTML = '';
  const numParticles = Math.floor(window.innerWidth / 8);
  for (let i = 0; i < numParticles; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.left = Math.random() * 100 + '%';
    p.style.animationDuration = (6 + Math.random() * 6) + 's';
    p.style.animationDelay = (-Math.random() * 8) + 's';
    p.style.opacity = 0.3 + Math.random() * 0.7;
    container.appendChild(p);
  }
}

function addDynamicStyles() {
	const style = document.createElement('style');
	style.textContent = `
		@keyframes energy-flow {
			0% { stroke-dasharray: 0 1000; }
			100% { stroke-dasharray: 1000 0; }
		}
		
		.orb {
			transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
		}
		
		.orb:hover {
			animation-play-state: paused;
		}
	`;
	document.head.appendChild(style);
}

function init() {
	createFloatingParticles();
	render3DTimeline();
	setupIntroModal();
	addDynamicStyles();
	animateParticles();
	
	window.addEventListener('resize', () => {
		clearTimeout(window.resizeTimeout);
		window.resizeTimeout = setTimeout(render3DTimeline, 250);
	});
	

	const scrollIndicator = document.querySelector('.scroll-indicator');
	if (scrollIndicator) {
		setTimeout(() => {
			scrollIndicator.style.opacity = '0';
		}, 5000);
	}
}

function showLoadingScreen() {
	const loadingScreen = document.getElementById('loading-screen');
	if (!loadingScreen) return;
	
	setTimeout(() => {
		loadingScreen.classList.add('hide');
		setTimeout(() => {
			loadingScreen.style.display = 'none';
		}, 500);
	}, 2000);
}

function init() {
	createFloatingParticles();
	render3DTimeline();
	setupIntroModal();
	setupMemoryModal();
	addDynamicStyles();
	animateParticles();
	
	window.addEventListener('resize', () => {
		clearTimeout(window.resizeTimeout);
		window.resizeTimeout = setTimeout(() => {
			animateParticles();
			render3DTimeline();
		}, 250);
	});
}

window.addEventListener('DOMContentLoaded', () => {
	showLoadingScreen();
	
	setTimeout(() => {
		init();
	}, 2500);
});

window.addEventListener('beforeunload', () => {
	if (animationFrameId) {
		cancelAnimationFrame(animationFrameId);
	}
});
